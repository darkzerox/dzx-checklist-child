!function($,$window,$document){function getRoomList(proid){return $.ajax({type:"POST",url:darkxee_plist.callurl,data:{action:"getRoom",rid:proid},dataType:"json",success:function(data){var list=`<div class="title-head">\n                      <h2>Room</h2>\n                    </div><ul pro="${proid}">`;$.each(data,function(key,val){var incheck=1==val.room_type?"checked":"",outcheck=2==val.room_type?"checked":"";list+=`<li ac="old" proid="${proid}" room="${val.id}">\n            <input class="room_name" type="text" value="${val.name}"  room="${val.id}" >        \n            <div class="form-check form-check-inline">\n              <input class="form-check-input" type="radio" name="roomPositon-${val.id}" id="room_${val.id}-1" value="1" ${incheck}>\n              <label class="form-check-label" for="room_${val.id}-1">Inside</label>\n            </div>\n            <div class="form-check form-check-inline">\n              <input class="form-check-input" type="radio" name="roomPositon-${val.id}" id="room_${val.id}-2" value="2" ${outcheck}>\n              <label class="form-check-label" for="room_${val.id}-2">Outside </label>\n            </div>\n            <div class="room-del inline"><button class="btn btn-danger btn-sm btn-del-room" type="room" rid="${val.id}"><i class="fas fa-trash-alt "></i></button></div>\n          </li>`}),list+='</ul>\n        <button class="btn btn-info btn-sm insert_row_room"><i class="fas fa-plus"></i></button> \n        <button class="btn btn-success btn-sm save_row_room"><i class="fas fa-save"></i> Save</button>',$("#room_lists").html(list),$("#room_lists li").change(function(){$(this).attr("ac","change")}),$(".insert_row_room").click(function(){$("#room_lists ul").append(moreInput())}),admin_room_del(),admin_room_update()}})}function randomSTR(){for(var value="",possible="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=0;i<5;i++)value+=possible.charAt(Math.floor(Math.random()*possible.length));return value}$document.ajaxComplete(function(){$("#property_list , #property_report_list").selectpicker("destroy").selectpicker({liveSearch:!0,title:"Please select"}),$('.dropdown-menu li[data-original-index="1"]').hide(),$("body").hasClass("wp-admin")||$(".data-list .dropdown-menu li").click(function(){$("#property_data_dialog").modal("show")}),$(".bootstrap-select").click(function(){$(this).find(".dropdown-menu").hasClass("show")?$(this).find(".dropdown-menu").removeClass("show"):$(this).find(".dropdown-menu").addClass("show")})}),shadow(),$document.ready(function(){var uid,utype;$("body.home").find("#property_report_list").length>0&&get_report_list($("#property_report_list").attr("uid"),$("#property_report_list").attr("uty"));$(".more-menu").click(function(){$(".more-menu-item").toggleClass("show")}),$(".moveInOutReport").click(function(){var target=$(this).attr("stype"),pro=$(this).attr("pro"),title="0"==target?"Move in Detect Report":"Move out Detect Report";return $.ajax({type:"POST",url:darkxee_plist.callurl,data:{action:"get_report_inout",pro:pro,target:target},dataType:"json",success:function(data){var tbody="";$.each(data,function(key,value){tbody+=`<tr><td>${value.room_name}</td>\n                          <td>${value.fer_name}</td>\n                          <td><img src="${value.img}" /></td>\n                          <td>${value.comment}</td></tr>`}),$("#move_inout_report").html("").append(tbody),$("#moveInOutReportTitle").text(title),$("#moveInOutReport").modal("show")}})}),$("body").hasClass("page-template-page-room")&&$(".meu-inventory").addClass("current_page_item"),$(".page-report .fer_img").click(function(){var thisSrc=$(this).attr("src");$(".fer_img_pop").attr("src",thisSrc),$("#img_pop").modal("show")}),$(".furniture-list li.fer-list").click(function(e){e.preventDefault(),shadow(),sndsess("roID",$(this).attr("data")),sndsess("roN",$(this).text()),$(this).find("a").css("color","rgba(41, 180, 115, 0.27)"),setTimeout(function(){location.href="/inventory/room/"},1e3)}),$.wpMediaUploader();var getRow=$(".fern_data tr:last-child").html(),getRoomID=$(".fern_data tr:first-child").attr("room");$(".insert_row").click(function(){$.ajax({type:"POST",url:darkxee_plist.callurl,data:{action:"skele_inventory",room:getRoomID},success:function(data){$(".fern_data").append(data)}})}),$(".btn-del-fern").click(function(){var fer_id="";fer_id=$(this).attr("data-val");var fer_name=$(".fern_data tr[field="+fer_id+"]").find(".fer_name").val(),fer_img=$(".fern_data tr[field="+fer_id+"]").find(".fer_data.fer_img").attr("src");fer_img=void 0===fer_img?"":fer_img,$(".modal-body.del_fern").html(`<div class="fern-dialog-body center"><p>${fer_name}</p><img src="${fer_img}" /></div>`),$(".btn-fern-conf").attr("da",fer_id),$(".btn-fern-conf").click(function(){fer_id=$(this).attr("da"),$.ajax({type:"POST",url:darkxee_plist.callurl,data:{action:"fern_del",d:fer_id},success:function(data){console.log(data),$("#del-fern").modal("hide"),$(".fern_data tr[field="+fer_id+"]").remove()}})})}),$(".update_fern").click(function(){var fieldata=[];$(".fern_data tr").each(function(){var all_row={};all_row.room=$(this).parent().attr("room"),all_row.row_1=$(this).attr("field"),all_row.row_name=$(this).find(".fer_name").val(),all_row.row_img=$(this).find(".fer_img .fer_img").attr("src"),null==all_row.row_img&&(all_row.row_img=""),all_row.row_check_in=$(this).find(".fer_check.fer_check_in input:checked").val(),all_row.row_inphoto=$(this).find(".fer_img_in .fer_img").attr("src"),null==all_row.row_inphoto&&(all_row.row_inphoto=""),all_row.row_in_comment=$(this).find(".fer_comm_in").val(),all_row.row_check_out=$(this).find(".fer_check.fer_check_out input:checked").val(),all_row.row_outphoto=$(this).find(".fer_img_out .fer_img").attr("src"),null==all_row.row_outphoto&&(all_row.row_outphoto=""),all_row.row_out_comment=$(this).find(".fer_comm_out").val(),all_row.row_date=getDateTime(),fieldata.push(all_row)}),$.ajax({type:"POST",url:darkxee_plist.callurl,data:{action:"fern_insert",d:fieldata},success:function(data){}})}),checklist_reload(),$(".property-group .btn").click(function(e){e.preventDefault(),e.stopPropagation();var isGo=$(this).attr("go"),isAction=$(this).attr("ac"),fid=$(this).attr("fid");"update"==isAction&&getform_data(isGo+"-form",isGo,"update"),"insert"==isAction&&getform_data(isGo+"-form",isGo,"insert"),"ch-del"==isAction&&($(".selepro-btngroup").fadeOut(),$(".confirm-del").fadeIn()),"cancel"==isAction&&($(".selepro-btngroup").fadeIn(),$(".confirm-del").fadeOut()),"del"==isAction&&($(".selepro-btngroup").fadeIn(),$(".confirm-del").fadeOut(),delData(isGo,fid))}),$('.btn[ac="new"]').click(function(){var eleName=$(this).attr("go");$("#"+eleName+"-form").find("input").val(""),$("#"+eleName+"-form .btn").html('<i class="fas fa-save"></i> Save').removeClass("btn-info").addClass("btn-success").attr("ac","insert"),$("#room_lists").html("")}),show_property_list(),$(".date").datepicker({format:"yyyy-mm-dd",todayBtn:!0,todayHighlight:!0})});var moreInput=function(){var value=randomSTR();return`<li ac="new" radio_val = "${value}"><input class="room_name" type="text">        \n    <div class="form-check form-check-inline">\n      <input class="form-check-input" type="radio" name="roomPositon-${value}" id ="roomPositon-${value}-1" value="1" checked>\n      <label class="form-check-label" for="roomPositon-${value}-1">Inside</label>\n    </div>\n    <div class="form-check form-check-inline">\n      <input class="form-check-input" type="radio" name="roomPositon-${value}" id ="roomPositon-${value}-2" value="2">\n      <label class="form-check-label" for="roomPositon-${value}-2">Outside </label>\n    </div>\n    </li>`};function checklist_reload(){get_list_data("property","property_list")}function getform_data(form,table,state){var formData=$("#"+form).serializeArray();"update"==state&&updateData(table,formData),"insert"==state&&insertData(table,formData)}function get_report_list(uid,uty){return $.ajax({type:"POST",url:darkxee_plist.callurl,data:{action:"getReportList",uid:uid,uty:uty},dataType:"json",success:function(data){console.log(data);var select_data='<option value="-99">Select My Property</option>';$.each(data,function(key,value){select_data+=`<option value="${value.id}" data-tokens="${value.pro_id} ${value.pro_name}" data-subtext="${value.pro_id}" data-key="${value.linkkey}">${value.pro_name}</option>`}),$("#property_report_list option").not(".non-select").remove(),$("#property_report_list ").append(select_data),$(".report-data-list ").change(function(){var thiskey=$("#property_report_list option:selected").attr("data-key");console.log(thiskey),window.location.replace("/report/?d="+thiskey)})}})}function get_list_data(attr,ele){return $.ajax({type:"POST",url:darkxee_plist.callurl,data:{action:"getlList",attr:attr},dataType:"json",success:function(data){var field="";field="property"==attr?"pro_name":"name";var select_data='<option value="-99">Select Property</option>';$.each(data,function(key,value){select_data+=`<option value="${value.id}" data-tokens="${value.pro_id} ${value[field]}" data-subtext="${value.pro_id}">${value[field]}</option>`}),$("#"+ele+" option").not(".non-select").remove(),$("#"+ele).append(select_data),"name"==field&&($("#input_"+attr+" option").not(".non-select").remove(),$("#input_"+attr).append(select_data)),$(".bootstrap-select").click(function(){console.log("select click"),$(this).find(".dropdown-menu").hasClass("show")?$(this).find(".dropdown-menu").removeClass("show"):$(this).find(".dropdown-menu").addClass("show")})}})}function show_property_list(){$(".data-list").change(function(){var thisForm=$(this),eleName=$(this).attr("data"),thisVal=$(this).val();$('.btn[ac="del"]').attr("fid",thisVal),$("#"+eleName+"-form .btn").html('<i class="fas fa-save"></i> Update').removeClass("btn-info").addClass("btn-success").attr("ac","update"),thisVal>-1?$.ajax({type:"POST",url:darkxee_plist.callurl,data:{action:"get_property_detail",pid:$(this).val(),t:eleName},dataType:"json",success:function(data){data=data[0],$("#"+eleName+"-form .form-control").each(function(){var getName=$(this).attr("name");$(this).val(data[getName])}),thisForm.hasClass("page-data-list")&&($("#property_data_dialog_title").text(data.pro_name),$("#property_data_dialog #pro_address").text(data.address),$("#property_data_dialog #pro_district").text(data.district),$("#property_data_dialog #pro_city").text(data.city),$("#property_data_dialog #pro_provice").text(data.provice),$("#property_data_dialog #pro_zipcode").text(data.zipcode),$("#property_data_dialog #pro_start").text(data.startdate),$("#property_data_dialog #pro_end").text(data.enddate),$("body").hasClass("wp-admin")&&getRoomList(data.id),$.ajax({type:"POST",url:darkxee_plist.callurl,data:{action:"getuserData",id:data.landlord_id,type:"landlord"},success:function(data){"admin"!=(data=JSON.parse(data)).nickname[0]&&("first_name"in data&&$("#property_data_dialog #landlord_name").text(data.first_name[0]),"address"in data&&$("#property_data_dialog #landlord_address").text(data.address[0]),"district"in data&&$("#property_data_dialog #landlord_district").text(data.district[0]),"city"in data&&$("#property_data_dialog #landlord_city").text(data.city[0]),"provice"in data&&$("#property_data_dialog #landlord_provice").text(data.provice[0]),"zipcode"in data&&$("#property_data_dialog #landlord_zipcode").text(data.zipcode[0]),"phone"in data&&$("#property_data_dialog #landlord_tel").text(data.phone[0]),"email"in data&&$("#property_data_dialog #landlord_email").text(data.email))}}),$.ajax({type:"POST",url:darkxee_plist.callurl,data:{action:"getuserData",id:data.tenant_id,type:"tenant"},success:function(data){"admin"!=(data=JSON.parse(data)).nickname[0]&&("first_name"in data&&$("#property_data_dialog #tenant_name").text(data.first_name[0]),"address"in data&&$("#property_data_dialog #tenant_address").text(data.address[0]),"district"in data&&$("#property_data_dialog #tenant_district").text(data.district[0]),"city"in data&&$("#property_data_dialog #tenant_city").text(data.city[0]),"provice"in data&&$("#property_data_dialog #tenant_provice").text(data.provice[0]),"zipcode"in data&&$("#property_data_dialog #tenant_zipcode").text(data.zipcode[0]),"phone"in data&&$("#property_data_dialog #tenant_tel").text(data.phone[0]),"email"in data&&$("#property_data_dialog #tenant_email").text(data.email))}}),$("body").hasClass("wp-admin")||$("#property_data_dialog").modal("show"))}}):($("#"+eleName+"-form").find("input").val(""),$("#"+eleName+"-form .btn").text("Save").removeClass("btn-primary").addClass("btn-info").attr("ac","insert"))})}function insertData(table,data){$.ajax({type:"POST",url:darkxee_plist.callurl,data:{action:"checklist_insert_table",td:data,tn:table},success:function(data){var state_msg;msgState(data),1==data&&($("#"+table+"-form input").val(""),checklist_reload())}})}function msgState(ch){var state_msg;state_msg=ch?'<div class="msg-state"><div class="alert alert-success" role="alert">Success</div></div>':'<div class="msg-state"><div class="alert alert-danger" role="alert">Fail</div></div>',$(".msg-state").remove(),$("body").append(state_msg),$(".msg-state").fadeIn("fast").delay(3e3).fadeOut("fast")}function updateData(table,data){$.ajax({type:"POST",url:darkxee_plist.callurl,data:{action:"checklist_update_table",table_data:data,table_name:table},success:function(data){msgState(data),1==data&&($("#"+table+"-form input").val(""),checklist_reload())}})}function delData(table,id){$.ajax({type:"POST",url:darkxee_plist.callurl,data:{action:"checklist_del_table",tid:id,tn:table},success:function(data){msgState(data),1==data&&($("#"+table+"-form input").val(""),checklist_reload())}})}function get_people(table,id){$.ajax({type:"POST",url:darkxee_plist.callurl,data:{action:"get_people",table_name:table,id:id},success:function(data){var chData=0!=(data=JSON.parse(data)).length;data=data[0];var ele="#"+table+"_data input",elesele="#"+table+"_list";chData?$(elesele).val(data.id):$(elesele).val(0),$(ele).each(function(){if(chData){var ele_name=$(this).attr("name");$(this).val(data[ele_name])}$(this).css("width",$(this).textWidth()+10+"px"),$(this).on("mouseenter mouseleave change keydown",function(){$(this).css("width",$(this).textWidth()+10+"px")})})}})}function sndsess(n,v){$.ajax({type:"POST",url:darkxee_plist.callurl,data:{action:"build_sess",sName:n,sVal:v}})}function getDateTime(){var d=new Date,month=d.getMonth()+1,day=d.getDate(),output;return d.getFullYear()+"-"+((""+month).length<2?"0":"")+month+"-"+((""+day).length<2?"0":"")+day+" "+d.getHours()+":"+d.getMinutes()+":"+d.getSeconds()}function admin_room_update(){$(".save_row_room").click(function(){var abjData=[],proid=$("#room_lists ul").attr("pro");$("#room_lists li").each(function(){var roomObj={};roomObj.roomName=$(this).find(".room_name").val(),roomObj.roomID=$(this).attr("room"),roomObj.roomType=$(this).find("input.form-check-input:checked").val(),roomObj.acType=$(this).attr("ac"),roomObj.proID=proid,""!=roomObj.roomName&&abjData.push(roomObj)}),$.ajax({type:"POST",url:darkxee_plist.callurl,data:{action:"updateRoom",d:abjData},success:function(data){msgState(data),getRoomList(proid)}})})}function admin_room_del(){$(".btn-del-room").click(function(){var rid;delData("room",$(this).attr("rid")),$(this).parent().parent().fadeOut("normal",function(){$(this).remove()})})}function ferClickCheck(){$(".fer_check").each(function(){$(this).click(function(){var ischeck;console.log("cc"),$(this).find("svg").toggleClass("isCheck"),0==$(this).find("input").attr("val")?$(this).find("input").attr("val",1):$(this).find("input").attr("val",0)})})}function shadow(){$(".shadow-load").fadeIn(),$window.load(function(){$(".shadow-load").fadeOut()}),$document.ajaxComplete(function(){$(".shadow-load").fadeOut()})}$.fn.textWidth=function(text,font){return $.fn.textWidth.fakeEl||($.fn.textWidth.fakeEl=$("<span>").hide().appendTo(document.body)),$.fn.textWidth.fakeEl.text(text||this.val()||this.text()).css("font",font||this.css("font")),$.fn.textWidth.fakeEl.width()},$document.ready(function(){var savePNGButton="",clearButton_tenant,clearButton_landlord;if($.find(".signature-pad").length>0){var wrapper_tenant=document.getElementById("signature-tenant");clearButton_tenant=wrapper_tenant.querySelector("[data-action=clear]"),savePNGButton=wrapper_tenant.querySelector("[data-action=save-png]");var canvas_tenant=wrapper_tenant.querySelector("canvas");canvas_tenant.width="700",canvas_tenant.height="320";var signaturePad_tenant=new SignaturePad(canvas_tenant,{backgroundColor:"rgb(255, 255, 255)"}),wrapper_landlord=document.getElementById("signature-landlord");clearButton_landlord=wrapper_landlord.querySelector("[data-action=clear]"),savePNGButton=wrapper_landlord.querySelector("[data-action=save-png]");var canvas_landlord=wrapper_landlord.querySelector("canvas");canvas_landlord.width="700",canvas_landlord.height="320";var signaturePad_landlord=new SignaturePad(canvas_landlord,{backgroundColor:"rgb(255, 255, 255)"})}function resizeCanvas(){var ratio=Math.max(window.devicePixelRatio||1,1);canvas_tenant.width=canvas_tenant.offsetWidth*ratio,canvas_tenant.height=canvas_tenant.offsetHeight*ratio,canvas_tenant.getContext("2d").scale(ratio,ratio),signaturePad_tenant.clear(),canvas_landlord.width=canvas_landlord.offsetWidth*ratio,canvas_landlord.height=canvas_landlord.offsetHeight*ratio,canvas_landlord.getContext("2d").scale(ratio,ratio),signaturePad_landlord.clear()}function dataURLToBlob(dataURL){for(var parts=dataURL.split(";base64,"),contentType=parts[0].split(":")[1],raw=window.atob(parts[1]),rawLength=raw.length,uInt8Array=new Uint8Array(rawLength),i=0;i<rawLength;++i)uInt8Array[i]=raw.charCodeAt(i);return new Blob([uInt8Array],{type:contentType})}$.find(".signature-pad").length>0&&$(".sign-btn").click(function(){var thisBtn=$(this),data=thisBtn.attr("data-action"),dataRole=thisBtn.attr("datarole"),dataID=thisBtn.attr("data-id"),dataURL="";if("clear"==data&&($(".save.sign-btn").addClass("btn-info").removeClass("btn-success").text("save"),"landlord"==dataRole&&signaturePad_landlord.clear(),"tenant"==dataRole&&signaturePad_tenant.clear()),"save-png"==data){"landlord"==dataRole&&(signaturePad_landlord.isEmpty()?alert("Please provide a signature first."):dataURL=signaturePad_landlord.toDataURL()),"tenant"==dataRole&&(signaturePad_tenant.isEmpty()?alert("Please provide a signature first."):dataURL=signaturePad_tenant.toDataURL());var formData=new FormData;formData.append("action","add_sign"),formData.append("bs",dataURL),formData.append("rid",dataID),formData.append("rs",dataRole),""!=dataURL&&(shadow(),$.ajax({type:"POST",url:darkxee_plist.callurl,data:formData,processData:!1,contentType:!1,success:function(data){thisBtn.removeClass("btn-info").addClass("btn-success").text("Success"),$("."+dataRole+"_sign_img").attr("src",dataURL),$("#"+dataRole+"_signture_dialog").modal("hide")}}))}})})}(jQuery,jQuery(window),jQuery(document));